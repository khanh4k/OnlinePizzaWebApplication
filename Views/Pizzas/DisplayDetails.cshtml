@model Pizzas

@{
    var ModelName = "Pizza Details";
    ViewData["Title"] = ModelName;
}

<h2>@ModelName</h2>
<hr />

<p>
    <a asp-action="ListAll">Back to List</a>
</p>

<div class="thumbnail">
    <img alt="@Model.Name" src="@Model.ImageUrl" height="800" width="800" class="img-responsive" >
    <div class="caption-full">
        <h2 class="pull-right">@Model.Price.ToString("c")</h2>
        <h2>
            <a href="">@Model.Name</a>
        </h2>
        <div>
        <h4>Category: <b> @Model.Category.Name </b></h4>
        <p>@Model.Description</p>
        <p>
            <h4><b>List of Ingredients:</b></h4>

            @if (ViewBag.PizzaIngredients.Count > 0)
        {
                @foreach (var ing in ViewBag.PizzaIngredients)
            {
                    <div> @ing </div>
                }
            }
            else
            {
                <div>No @Html.DisplayNameFor(Model => Model.PizzaIngredients) was found. </div>
            }
        </p>
        <p>
        @if (ViewBag.AverageReviewScore > 0)
        {
            <h4>Average Review Score: <b> @ViewBag.AverageReviewScore </b></h4>
        }
        else
        {
            <h4>No Reviews was found. </h4>
        }

        @if (ViewBag.AverageReviewScore <= 0 || ViewBag.AverageReviewScore > 5)
        {
            <img class="review-stars" src="~/images/0stars.png" alt="No Reviews was found." />
        }
        else if (ViewBag.AverageReviewScore > 4.5)
        {
            <img class="review-stars" src="~/images/5stars.png" alt="5 stars picture." />
        }
        else if (ViewBag.AverageReviewScore > 4.0)
        {
            <img class="review-stars" src="~/images/4.5stars.png" alt="4.5 stars picture." />
        }
        else if (ViewBag.AverageReviewScore > 3.5)
        {
            <img class="review-stars" src="~/images/4stars.png" alt="4 stars picture." />
        }
        else if (ViewBag.AverageReviewScore > 3.0)
        {
            <img class="review-stars" src="~/images/3.5stars.png" alt="3.5 stars picture." />
        }
        else if (ViewBag.AverageReviewScore > 2.5)
        {
            <img class="review-stars" src="~/images/3stars.png" alt="3 stars picture." />
        }
        else if (ViewBag.AverageReviewScore > 2.0)
        {
            <img class="review-stars" src="~/images/2.5stars.png" alt="2.5 stars picture." />
        }
        else if (ViewBag.AverageReviewScore > 1.5)
        {
            <img class="review-stars" src="~/images/2stars.png" alt="2 stars picture." />
        }
        else if (ViewBag.AverageReviewScore > 1.0)
        {
            <img class="review-stars" src="~/images/1.5stars.png" alt="1.5 stars picture." />
        }
        else
        {
            <img class="review-stars" src="~/images/1star.png" alt="1 star picture." />
        }

        </p>
            <h3>Customer Reviews</h3>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <form asp-action="CreateWithPizza" asp-controller="Reviews" method="post">
                                <input type="hidden" name="PizzaId" value="@Model.Id" />

                                <div class="mb-3">
                                    <label for="Title" class="form-label fw-bold">Review Title</label>
                                    <input name="Title" id="Title" class="form-control" placeholder="Enter your review title" required />
                                </div>

                                <div class="mb-3">
                                    <label for="Description" class="form-label fw-bold">Description</label>
                                    <textarea name="Description" id="Description" class="form-control" rows="3" placeholder="Write your detailed feedback" required></textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="Grade" class="form-label fw-bold">Rating</label>
                                    <select name="Grade" id="Grade" class="form-select" required>
                                        <option value="">-- Select rating --</option>
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            <option value="@i">@i Star@(i > 1 ? "s" : "")</option>
                                        }
                                    </select>
                                </div>

                                <button type="submit" class="btn btn-success w-100">
                                    <i class="bi bi-check-circle"></i> Submit Review
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Hiển thị danh sách review -->
            @if (ViewBag.Reviews != null && ((List<Reviews>)ViewBag.Reviews).Count > 0)
            {
                <table class="table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Grade</th>
                            <th>Date</th>
                            <th>Pizza</th>
                            <th>User</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in (List<Reviews>)ViewBag.Reviews)
                        {
                            <tr>
                                <td>@item.Title</td>
                                <td>@item.Description</td>
                                <td>@item.Grade</td>
                                <td>@item.Date.ToString("dd/MM/yyyy")</td>
                                <td>@item.Pizza.Name</td>
                                <td>@item.User?.Email</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p>No reviews found for this pizza.</p>
            }


        <br />
        <p class="button">
            <a class="btn btn-primary" asp-controller="ShoppingCart" asp-action="AddToShoppingCart"
                asp-route-pizzaId="@Model.Id">Add Pizza</a>
        </p>
    </div>
</div>
